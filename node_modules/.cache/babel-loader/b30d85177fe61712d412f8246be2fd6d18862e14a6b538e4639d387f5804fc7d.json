{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { supabase, handleSupabaseError, handleSupabaseSuccess } from '../lib/supabase';\nexport const useSupabaseBooks = () => {\n  _s();\n  const [books, setBooks] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // ðŸ“¥ Charger tous les livres\n  const loadBooks = async () => {\n    try {\n      setLoading(true);\n      const {\n        data,\n        error\n      } = await supabase.from('books').select('*').order('created_at', {\n        ascending: false\n      });\n      if (error) throw error;\n      setBooks(data || []);\n      setError(null);\n    } catch (err) {\n      console.error('Erreur chargement:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // âž• Ajouter un livre\n  const addBook = async book => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('books').insert([book]).select().single();\n      if (error) throw error;\n      setBooks([data, ...books]);\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // âœï¸ Mettre Ã  jour un livre\n  const updateBook = async (bookId, updates) => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('books').update(updates).eq('id', bookId).select().single();\n      if (error) throw error;\n      setBooks(books.map(book => book.id === bookId ? data : book));\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ—‘ï¸ Supprimer un livre\n  const deleteBook = async bookId => {\n    try {\n      const {\n        error\n      } = await supabase.from('books').delete().eq('id', bookId);\n      if (error) throw error;\n      setBooks(books.filter(book => book.id !== bookId));\n      return handleSupabaseSuccess();\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ“¦ Import multiple\n  const importBooks = async newBooks => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('books').insert(newBooks).select();\n      if (error) throw error;\n      setBooks([...data, ...books]);\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ—‘ï¸ Tout supprimer\n  const clearAllBooks = async () => {\n    if (!window.confirm('Voulez-vous vraiment supprimer TOUTES vos lectures ?')) {\n      return;\n    }\n    try {\n      const {\n        error\n      } = await supabase.from('books').delete().neq('id', 0); // Supprime tous les enregistrements\n\n      if (error) throw error;\n      setBooks([]);\n      return handleSupabaseSuccess();\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ“Š Statistiques\n  const getStats = () => ({\n    total: books.length,\n    finished: books.filter(b => b.status === 'finished').length,\n    reading: books.filter(b => b.status === 'reading').length,\n    stopped: books.filter(b => b.status === 'stopped').length\n  });\n\n  // ðŸ”„ Charger au montage\n  useEffect(() => {\n    loadBooks();\n\n    // ðŸŽ§ Ã‰couter les changements en temps rÃ©el (optionnel)\n    const subscription = supabase.channel('books_changes').on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'books'\n    }, payload => {\n      console.log('Changement dÃ©tectÃ©:', payload);\n      loadBooks(); // Recharger les donnÃ©es\n    }).subscribe();\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n  return {\n    books,\n    loading,\n    error,\n    addBook,\n    updateBook,\n    deleteBook,\n    clearAllBooks,\n    importBooks,\n    getStats,\n    refreshBooks: loadBooks\n  };\n};\n_s(useSupabaseBooks, \"EGY3pKkAurN47vKRxkkn2C8TkJw=\");","map":{"version":3,"names":["useState","useEffect","supabase","handleSupabaseError","handleSupabaseSuccess","useSupabaseBooks","_s","books","setBooks","loading","setLoading","error","setError","loadBooks","data","from","select","order","ascending","err","console","message","addBook","book","insert","single","updateBook","bookId","updates","update","eq","map","id","deleteBook","delete","filter","importBooks","newBooks","clearAllBooks","window","confirm","neq","getStats","total","length","finished","b","status","reading","stopped","subscription","channel","on","event","schema","table","payload","log","subscribe","unsubscribe","refreshBooks"],"sources":["/etudiants/siscol/f/ferna_ji/Bureau/BookTime/src/hooks/useSupabaseBooks.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { supabase, handleSupabaseError, handleSupabaseSuccess } from '../lib/supabase';\n\nexport const useSupabaseBooks = () => {\n  const [books, setBooks] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // ðŸ“¥ Charger tous les livres\n  const loadBooks = async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('books')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setBooks(data || []);\n      setError(null);\n    } catch (err) {\n      console.error('Erreur chargement:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // âž• Ajouter un livre\n  const addBook = async (book) => {\n    try {\n      const { data, error } = await supabase\n        .from('books')\n        .insert([book])\n        .select()\n        .single();\n\n      if (error) throw error;\n      \n      setBooks([data, ...books]);\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // âœï¸ Mettre Ã  jour un livre\n  const updateBook = async (bookId, updates) => {\n    try {\n      const { data, error } = await supabase\n        .from('books')\n        .update(updates)\n        .eq('id', bookId)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      setBooks(books.map(book => book.id === bookId ? data : book));\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ—‘ï¸ Supprimer un livre\n  const deleteBook = async (bookId) => {\n    try {\n      const { error } = await supabase\n        .from('books')\n        .delete()\n        .eq('id', bookId);\n\n      if (error) throw error;\n\n      setBooks(books.filter(book => book.id !== bookId));\n      return handleSupabaseSuccess();\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ“¦ Import multiple\n  const importBooks = async (newBooks) => {\n    try {\n      const { data, error } = await supabase\n        .from('books')\n        .insert(newBooks)\n        .select();\n\n      if (error) throw error;\n\n      setBooks([...data, ...books]);\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ—‘ï¸ Tout supprimer\n  const clearAllBooks = async () => {\n    if (!window.confirm('Voulez-vous vraiment supprimer TOUTES vos lectures ?')) {\n      return;\n    }\n\n    try {\n      const { error } = await supabase\n        .from('books')\n        .delete()\n        .neq('id', 0); // Supprime tous les enregistrements\n\n      if (error) throw error;\n\n      setBooks([]);\n      return handleSupabaseSuccess();\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ“Š Statistiques\n  const getStats = () => ({\n    total: books.length,\n    finished: books.filter(b => b.status === 'finished').length,\n    reading: books.filter(b => b.status === 'reading').length,\n    stopped: books.filter(b => b.status === 'stopped').length\n  });\n\n  // ðŸ”„ Charger au montage\n  useEffect(() => {\n    loadBooks();\n\n    // ðŸŽ§ Ã‰couter les changements en temps rÃ©el (optionnel)\n    const subscription = supabase\n      .channel('books_changes')\n      .on('postgres_changes', \n        { event: '*', schema: 'public', table: 'books' },\n        (payload) => {\n          console.log('Changement dÃ©tectÃ©:', payload);\n          loadBooks(); // Recharger les donnÃ©es\n        }\n      )\n      .subscribe();\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  return {\n    books,\n    loading,\n    error,\n    addBook,\n    updateBook,\n    deleteBook,\n    clearAllBooks,\n    importBooks,\n    getStats,\n    refreshBooks: loadBooks\n  };\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}