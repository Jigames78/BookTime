{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { supabase, handleSupabaseError, handleSupabaseSuccess } from '../lib/supabase';\nimport { getCoverUrl } from '../utils/imageGenerator';\nexport const useSupabaseBooks = () => {\n  _s();\n  const [books, setBooks] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // ðŸ“¥ Charger tous les livres\n  const loadBooks = async () => {\n    try {\n      setLoading(true);\n      const {\n        data,\n        error\n      } = await supabase.from('books').select('*').order('created_at', {\n        ascending: false\n      });\n      if (error) throw error;\n      setBooks(data || []);\n      setError(null);\n    } catch (err) {\n      console.error('Erreur chargement:', err);\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // âž• Ajouter un livre\n  const addBook = async book => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('books').insert([book]).select().single();\n      if (error) throw error;\n      setBooks([data, ...books]);\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // âœï¸ Mettre Ã  jour un livre\n  const updateBook = async (bookId, updates) => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('books').update(updates).eq('id', bookId).select().single();\n      if (error) throw error;\n      setBooks(books.map(book => book.id === bookId ? data : book));\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ—‘ï¸ Supprimer un livre\n  const deleteBook = async bookId => {\n    try {\n      const {\n        error\n      } = await supabase.from('books').delete().eq('id', bookId);\n      if (error) throw error;\n      setBooks(books.filter(book => book.id !== bookId));\n      return handleSupabaseSuccess();\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ“¦ Import multiple avec recherche automatique des couvertures\n  const importBooks = async newBooks => {\n    try {\n      console.log(`ðŸ”„ Import de ${newBooks.length} livres...`);\n\n      // Chercher les couvertures pour chaque livre\n      const booksWithCovers = await Promise.all(newBooks.map(async book => {\n        console.log(`ðŸ” Recherche couverture pour: ${book.title}`);\n        const cover = await getCoverUrl(book.title);\n        return {\n          ...book,\n          cover\n        };\n      }));\n\n      // InsÃ©rer tous les livres avec leurs couvertures\n      const {\n        data,\n        error\n      } = await supabase.from('books').insert(booksWithCovers).select();\n      if (error) throw error;\n      setBooks([...data, ...books]);\n      console.log(`âœ… ${data.length} livres importÃ©s avec succÃ¨s !`);\n      return handleSupabaseSuccess(data);\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ—‘ï¸ Tout supprimer\n  const clearAllBooks = async () => {\n    if (!window.confirm('Voulez-vous vraiment supprimer TOUTES vos lectures ?')) {\n      return;\n    }\n    try {\n      const {\n        error\n      } = await supabase.from('books').delete().neq('id', 0);\n      if (error) throw error;\n      setBooks([]);\n      return handleSupabaseSuccess();\n    } catch (err) {\n      return handleSupabaseError(err);\n    }\n  };\n\n  // ðŸ“Š Statistiques\n  const getStats = () => ({\n    total: books.length,\n    finished: books.filter(b => b.status === 'finished').length,\n    reading: books.filter(b => b.status === 'reading').length,\n    stopped: books.filter(b => b.status === 'stopped').length,\n    autre: books.filter(b => b.status === 'autre').length\n  });\n\n  // ðŸ”„ Charger au montage\n  useEffect(() => {\n    loadBooks();\n\n    // ðŸŽ§ Ã‰couter les changements en temps rÃ©el\n    const subscription = supabase.channel('books_changes').on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'books'\n    }, payload => {\n      console.log('Changement dÃ©tectÃ©:', payload);\n      loadBooks();\n    }).subscribe();\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n  return {\n    books,\n    loading,\n    error,\n    addBook,\n    updateBook,\n    deleteBook,\n    clearAllBooks,\n    importBooks,\n    getStats,\n    refreshBooks: loadBooks\n  };\n};\n_s(useSupabaseBooks, \"EGY3pKkAurN47vKRxkkn2C8TkJw=\");","map":{"version":3,"names":["useState","useEffect","supabase","handleSupabaseError","handleSupabaseSuccess","getCoverUrl","useSupabaseBooks","_s","books","setBooks","loading","setLoading","error","setError","loadBooks","data","from","select","order","ascending","err","console","message","addBook","book","insert","single","updateBook","bookId","updates","update","eq","map","id","deleteBook","delete","filter","importBooks","newBooks","log","length","booksWithCovers","Promise","all","title","cover","clearAllBooks","window","confirm","neq","getStats","total","finished","b","status","reading","stopped","autre","subscription","channel","on","event","schema","table","payload","subscribe","unsubscribe","refreshBooks"],"sources":["C:/Users/jimmy/Desktop/BookTime/src/hooks/useSupabaseBooks.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { supabase, handleSupabaseError, handleSupabaseSuccess } from '../lib/supabase';\r\nimport { getCoverUrl } from '../utils/imageGenerator';\r\n\r\nexport const useSupabaseBooks = () => {\r\n  const [books, setBooks] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // ðŸ“¥ Charger tous les livres\r\n  const loadBooks = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('books')\r\n        .select('*')\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setBooks(data || []);\r\n      setError(null);\r\n    } catch (err) {\r\n      console.error('Erreur chargement:', err);\r\n      setError(err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // âž• Ajouter un livre\r\n  const addBook = async (book) => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('books')\r\n        .insert([book])\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      \r\n      setBooks([data, ...books]);\r\n      return handleSupabaseSuccess(data);\r\n    } catch (err) {\r\n      return handleSupabaseError(err);\r\n    }\r\n  };\r\n\r\n  // âœï¸ Mettre Ã  jour un livre\r\n  const updateBook = async (bookId, updates) => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('books')\r\n        .update(updates)\r\n        .eq('id', bookId)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      setBooks(books.map(book => book.id === bookId ? data : book));\r\n      return handleSupabaseSuccess(data);\r\n    } catch (err) {\r\n      return handleSupabaseError(err);\r\n    }\r\n  };\r\n\r\n  // ðŸ—‘ï¸ Supprimer un livre\r\n  const deleteBook = async (bookId) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('books')\r\n        .delete()\r\n        .eq('id', bookId);\r\n\r\n      if (error) throw error;\r\n\r\n      setBooks(books.filter(book => book.id !== bookId));\r\n      return handleSupabaseSuccess();\r\n    } catch (err) {\r\n      return handleSupabaseError(err);\r\n    }\r\n  };\r\n\r\n  // ðŸ“¦ Import multiple avec recherche automatique des couvertures\r\n  const importBooks = async (newBooks) => {\r\n    try {\r\n      console.log(`ðŸ”„ Import de ${newBooks.length} livres...`);\r\n      \r\n      // Chercher les couvertures pour chaque livre\r\n      const booksWithCovers = await Promise.all(\r\n        newBooks.map(async (book) => {\r\n          console.log(`ðŸ” Recherche couverture pour: ${book.title}`);\r\n          const cover = await getCoverUrl(book.title);\r\n          return { ...book, cover };\r\n        })\r\n      );\r\n\r\n      // InsÃ©rer tous les livres avec leurs couvertures\r\n      const { data, error } = await supabase\r\n        .from('books')\r\n        .insert(booksWithCovers)\r\n        .select();\r\n\r\n      if (error) throw error;\r\n\r\n      setBooks([...data, ...books]);\r\n      console.log(`âœ… ${data.length} livres importÃ©s avec succÃ¨s !`);\r\n\r\n      return handleSupabaseSuccess(data);\r\n    } catch (err) {\r\n      return handleSupabaseError(err);\r\n    }\r\n  };\r\n\r\n  // ðŸ—‘ï¸ Tout supprimer\r\n  const clearAllBooks = async () => {\r\n    if (!window.confirm('Voulez-vous vraiment supprimer TOUTES vos lectures ?')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('books')\r\n        .delete()\r\n        .neq('id', 0);\r\n\r\n      if (error) throw error;\r\n\r\n      setBooks([]);\r\n      return handleSupabaseSuccess();\r\n    } catch (err) {\r\n      return handleSupabaseError(err);\r\n    }\r\n  };\r\n\r\n  // ðŸ“Š Statistiques\r\n  const getStats = () => ({\r\n    total: books.length,\r\n    finished: books.filter(b => b.status === 'finished').length,\r\n    reading: books.filter(b => b.status === 'reading').length,\r\n    stopped: books.filter(b => b.status === 'stopped').length,\r\n    autre: books.filter(b => b.status === 'autre').length\r\n  });\r\n\r\n  // ðŸ”„ Charger au montage\r\n  useEffect(() => {\r\n    loadBooks();\r\n\r\n    // ðŸŽ§ Ã‰couter les changements en temps rÃ©el\r\n    const subscription = supabase\r\n      .channel('books_changes')\r\n      .on('postgres_changes', \r\n        { event: '*', schema: 'public', table: 'books' },\r\n        (payload) => {\r\n          console.log('Changement dÃ©tectÃ©:', payload);\r\n          loadBooks();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      subscription.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    books,\r\n    loading,\r\n    error,\r\n    addBook,\r\n    updateBook,\r\n    deleteBook,\r\n    clearAllBooks,\r\n    importBooks,\r\n    getStats,\r\n    refreshBooks: loadBooks\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}