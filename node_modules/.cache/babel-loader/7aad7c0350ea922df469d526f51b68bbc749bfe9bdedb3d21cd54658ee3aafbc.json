{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Trash2,AlertCircle,CheckCircle,RotateCcw,X}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SUPABASE_URL=process.env.REACT_APP_SUPABASE_URL;const SUPABASE_KEY=process.env.REACT_APP_SUPABASE_ANON_KEY;export default function UndoImportModal(_ref){let{onClose}=_ref;const[recentBooks,setRecentBooks]=useState([]);const[loading,setLoading]=useState(true);const[deleting,setDeleting]=useState(false);const[message,setMessage]=useState(null);useEffect(()=>{loadRecentBooks();},[]);const loadRecentBooks=async()=>{try{setLoading(true);// Utiliser le client Supabase importé\nconst{createClient}=await import('@supabase/supabase-js');const supabase=createClient(SUPABASE_URL,SUPABASE_KEY);const{data,error}=await supabase.from('books').select('*').order('created_at',{ascending:false}).limit(50);if(error)throw error;const groups=groupByMinute(data||[]);setRecentBooks(groups);}catch(error){console.error('Erreur:',error);showMessage('Erreur de chargement','error');}finally{setLoading(false);}};const groupByMinute=books=>{const groups=[];const sortedBooks=[...books].sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));let currentGroup=[];let lastTime=null;sortedBooks.forEach(book=>{const bookTime=new Date(book.created_at);if(!lastTime||lastTime-bookTime<60000){currentGroup.push(book);lastTime=bookTime;}else{if(currentGroup.length>0){groups.push([...currentGroup]);}currentGroup=[book];lastTime=bookTime;}});if(currentGroup.length>0){groups.push(currentGroup);}return groups;};const deleteGroup=async group=>{const count=group.length;if(!window.confirm(\"Voulez-vous vraiment supprimer ces \".concat(count,\" livre(s) ajout\\xE9(s) r\\xE9cemment ?\"))){return;}setDeleting(true);let deleted=0;try{// Utiliser le client Supabase\nconst{createClient}=await import('@supabase/supabase-js');const supabase=createClient(SUPABASE_URL,SUPABASE_KEY);for(const book of group){try{const{error}=await supabase.from('books').delete().eq('id',book.id);if(!error){deleted++;}}catch(error){console.error('Erreur suppression:',error);}}showMessage(\"\".concat(deleted,\" livre(s) supprim\\xE9(s) !\"),'success');setTimeout(()=>{onClose();window.location.reload();},1500);}catch(error){showMessage('Erreur lors de la suppression','error');}finally{setDeleting(false);}};const showMessage=(text,type)=>{setMessage({text,type});setTimeout(()=>setMessage(null),3000);};const getStatusInfo=status=>{const statusMap={'reading':{label:'En cours',color:'bg-blue-500'},'finished':{label:'Terminé',color:'bg-green-500'},'stopped':{label:'Arrêté',color:'bg-red-500'},'autre':{label:'Autre',color:'bg-amber-500'}};return statusMap[status]||{label:status,color:'bg-gray-500'};};const formatDate=dateString=>{const date=new Date(dateString);const now=new Date();const diffMs=now-date;const diffMins=Math.floor(diffMs/60000);const diffHours=Math.floor(diffMs/3600000);const diffDays=Math.floor(diffMs/86400000);if(diffMins<1)return'À l\\'instant';if(diffMins<60)return\"Il y a \".concat(diffMins,\" min\");if(diffHours<24)return\"Il y a \".concat(diffHours,\"h\");return\"Il y a \".concat(diffDays,\"j\");};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-lg bg-black/80\",onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"rounded-3xl p-6 max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-gray-700 bg-gray-800/95\",onClick:e=>e.stopPropagation(),children:[message&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl \".concat(message.type==='success'?'bg-green-600':'bg-red-600'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[message.type==='success'?/*#__PURE__*/_jsx(CheckCircle,{className:\"w-5 h-5\"}):/*#__PURE__*/_jsx(AlertCircle,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:message.text})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(RotateCcw,{className:\"w-8 h-8 text-teal-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-white\",children:\"Annuler le dernier import\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400\",children:\"Supprimez les livres ajout\\xE9s par erreur\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-400 hover:text-white\",children:/*#__PURE__*/_jsx(X,{className:\"w-6 h-6\"})})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-16\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-400\",children:\"Chargement...\"})]}):recentBooks.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-16 bg-gray-900/50 rounded-2xl border border-gray-700\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-16 h-16 mx-auto mb-4 text-gray-600\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl text-gray-400\",children:\"Aucun livre r\\xE9cent trouv\\xE9\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-6\",children:recentBooks.map((group,groupIndex)=>/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-900/50 rounded-2xl border border-gray-700 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-teal-400\",children:group.length===1?'1 livre':\"\".concat(group.length,\" livres\")}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-400\",children:[\"Ajout\\xE9(s) \",formatDate(group[0].created_at)]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>deleteGroup(group),disabled:deleting,className:\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-500 hover:to-rose-500 rounded-xl font-semibold transition-all disabled:opacity-50\",children:[/*#__PURE__*/_jsx(Trash2,{className:\"w-5 h-5\"}),\"Supprimer ce groupe\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:group.map(book=>{const statusInfo=getStatusInfo(book.status);return/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-800/50 rounded-xl p-4 border border-gray-700 hover:border-teal-500 transition-all\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"img\",{src:book.cover,alt:book.title,className:\"w-16 h-24 object-cover rounded-lg\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-white truncate mb-1\",children:book.title}),book.author&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-400 truncate mb-2\",children:book.author}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"\".concat(statusInfo.color,\" text-xs px-2 py-1 rounded-full\"),children:statusInfo.label}),book.episode&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-purple-400\",children:[\"\\xC9p. \",book.episode]})]})]})]})},book.id);})})]},groupIndex))})]})});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}